# ä»£ç å®¡æŸ¥æ£€æŸ¥æ¸…å•

æœ¬æ–‡æ¡£åˆ—å‡ºäº†æ‰€æœ‰PRæäº¤å‰å¿…é¡»æ£€æŸ¥çš„å¼ºåˆ¶æ€§è§„åˆ™ã€‚**è¿åä»»ä½•ä¸€æ¡è§„åˆ™çš„ä»£ç å°†è¢«ç›´æ¥æ‹’ç»ã€‚**

## å¿…é¡»éµå®ˆçš„è§„åˆ™ï¼ˆå¼ºåˆ¶æ€§ï¼‰

### 1. âŒ ç¦æ­¢ä½¿ç”¨UTCæ—¶é—´

**è§„åˆ™**ï¼šæ•´ä¸ªé¡¹ç›®ä»»ä½•åœ°æ–¹ï¼ˆåŒ…æ‹¬æµ‹è¯•ä»£ç ï¼‰éƒ½ä¸èƒ½ä½¿ç”¨UTCæ—¶é—´ï¼Œå¿…é¡»ç»Ÿä¸€ä½¿ç”¨æœ¬åœ°æ—¶é—´ã€‚

**ç¦æ­¢çš„å†™æ³•**ï¼š
```csharp
// âŒ é”™è¯¯
var now = DateTime.UtcNow;
var timestamp = DateTimeOffset.UtcNow;
```

**æ­£ç¡®çš„å†™æ³•**ï¼š
```csharp
// âœ… æ­£ç¡®
var now = DateTime.Now;
var timestamp = DateTimeOffset.Now;

// æˆ–ä½¿ç”¨æ—¶é—´æä¾›å™¨ï¼ˆæ¨èï¼‰
var now = _timeProvider.Now;
```

**æ£€æŸ¥æ–¹æ³•**ï¼š
```bash
# åœ¨æäº¤å‰è¿è¡Œæ­¤å‘½ä»¤ï¼Œç¡®ä¿è¿”å›0ï¼ˆåŒ…æ‹¬æµ‹è¯•ä»£ç ï¼‰
grep -r "DateTime\.UtcNow\|DateTimeOffset\.UtcNow" --include="*.cs" | grep -v "bin\|obj" | wc -l
```

### 2. âœ… ä½¿ç”¨ required + init å®ç°å®‰å…¨çš„å¯¹è±¡åˆ›å»º

**è§„åˆ™**ï¼šç¡®ä¿å…³é”®å±æ€§åœ¨å¯¹è±¡åˆ›å»ºæ—¶å¿…é¡»è¢«è®¾ç½®ï¼Œé¿å…åŠåˆå§‹åŒ–å¯¹è±¡ã€‚

**ç¤ºä¾‹**ï¼š
```csharp
// âœ… æ­£ç¡®
public class Config
{
    public required string Name { get; init; }
    public required int Value { get; init; }
}

// ä½¿ç”¨æ—¶
var config = new Config 
{ 
    Name = "test", 
    Value = 100 
};
```

### 3. âœ… å¯ç”¨å¯ç©ºå¼•ç”¨ç±»å‹

**è§„åˆ™**ï¼šæ‰€æœ‰é¡¹ç›®å¿…é¡»å¯ç”¨ `<Nullable>enable</Nullable>`ï¼Œä¸¥è‚ƒå¤„ç†ç©ºå¼•ç”¨è­¦å‘Šã€‚

**æ£€æŸ¥æ–¹æ³•**ï¼š
- é¡¹ç›®æ–‡ä»¶ä¸­æœ‰ `<Nullable>enable</Nullable>`
- ç¼–è¯‘æ—¶æ²¡æœ‰å¯ç©ºå¼•ç”¨è­¦å‘Š

### 4. âœ… ä½¿ç”¨æ–‡ä»¶ä½œç”¨åŸŸç±»å‹

**è§„åˆ™**ï¼šå·¥å…·ç±»å’Œå†…éƒ¨è¾…åŠ©ç±»å‹ä½¿ç”¨ `file` å…³é”®å­—ï¼Œé¿å…æ±¡æŸ“å…¨å±€å‘½åç©ºé—´ã€‚

**ç¤ºä¾‹**ï¼š
```csharp
// âœ… æ­£ç¡® - æ–‡ä»¶ä½œç”¨åŸŸç±»å‹
file sealed class InternalHelper
{
    // ...
}

// å…¬å…±APIä½¿ç”¨public
public class PublicService
{
    // ...
}
```

### 5. âœ… ä½¿ç”¨ record å¤„ç†ä¸å¯å˜æ•°æ®

**è§„åˆ™**ï¼šDTOã€äº‹ä»¶è½½è·å’Œåªè¯»æ•°æ®ä¼˜å…ˆä½¿ç”¨ `record` æˆ– `record struct`ã€‚

**ç¤ºä¾‹**ï¼š
```csharp
// âœ… æ­£ç¡® - DTOä½¿ç”¨record
public record ConfigDto(string Name, int Value);

// âœ… æ­£ç¡® - äº‹ä»¶ä½¿ç”¨record struct
public readonly record struct ParcelCreatedEventArgs
{
    public required long ParcelId { get; init; }
    public required DateTimeOffset CreatedAt { get; init; }
}
```

### 6. âœ… ä¿æŒæ–¹æ³•ä¸“æ³¨ä¸”å°å·§

**è§„åˆ™**ï¼šä¸€ä¸ªæ–¹æ³•åªè´Ÿè´£ä¸€ä¸ªèŒè´£ï¼Œæ–¹æ³•è¡Œæ•°å»ºè®® < 50è¡Œã€‚

**ç¤ºä¾‹**ï¼š
```csharp
// âŒ é”™è¯¯ - æ–¹æ³•åšäº†å¤ªå¤šäº‹æƒ…
public void ProcessOrder(Order order)
{
    // éªŒè¯è®¢å•
    // è®¡ç®—ä»·æ ¼
    // å‘é€é€šçŸ¥
    // æ›´æ–°åº“å­˜
    // è®°å½•æ—¥å¿—
    // ... 100è¡Œä»£ç 
}

// âœ… æ­£ç¡® - æ‹†åˆ†æˆå¤šä¸ªèŒè´£å•ä¸€çš„æ–¹æ³•
public void ProcessOrder(Order order)
{
    ValidateOrder(order);
    var price = CalculatePrice(order);
    SendNotification(order);
    UpdateInventory(order);
    LogOrderProcessed(order);
}
```

### 7. âœ… ä¸éœ€è¦å¯å˜æ€§æ—¶ä¼˜å…ˆä½¿ç”¨ readonly struct

**è§„åˆ™**ï¼šå€¼ç±»å‹å¦‚æœä¸éœ€è¦ä¿®æ”¹ï¼Œä½¿ç”¨ `readonly struct` æå‡å®‰å…¨æ€§å’Œæ€§èƒ½ã€‚

**ç¤ºä¾‹**ï¼š
```csharp
// âœ… æ­£ç¡®
public readonly struct CartIndex
{
    public int Value { get; }
    
    public CartIndex(int value)
    {
        Value = value;
    }
}
```

### 8. âœ… APIå‚æ•°éªŒè¯ä½¿ç”¨ç‰¹æ€§æ ‡è®°

**è§„åˆ™**ï¼šæ‰€æœ‰APIå…¥å‚å¿…é¡»é€šè¿‡ç‰¹æ€§ï¼ˆAttributeï¼‰è¿›è¡ŒéªŒè¯ï¼Œä¸å…è®¸ä»…ä¾èµ–æ‰‹å†™ifåˆ¤æ–­ã€‚

**ç¤ºä¾‹**ï¼š
```csharp
// âœ… æ­£ç¡®
public class UpdateConfigRequest
{
    [Required(ErrorMessage = "é…ç½®IDä¸èƒ½ä¸ºç©º")]
    public required string ConfigId { get; init; }
    
    [Range(1, 1000, ErrorMessage = "æ•°å€¼å¿…é¡»åœ¨1-1000ä¹‹é—´")]
    public required int Value { get; init; }
}
```

## PRæäº¤å‰æ£€æŸ¥æ¸…å•

åœ¨æäº¤PRå‰ï¼Œè¯·ç¡®è®¤ä»¥ä¸‹æ‰€æœ‰é¡¹ï¼š

- [ ] **æ²¡æœ‰ä½¿ç”¨UTCæ—¶é—´**ï¼ˆè¿è¡Œgrepå‘½ä»¤éªŒè¯ï¼‰
- [ ] å…³é”®å¯¹è±¡ä½¿ç”¨äº† `required` + `init`
- [ ] é¡¹ç›®å¯ç”¨äº†å¯ç©ºå¼•ç”¨ç±»å‹
- [ ] å·¥å…·ç±»ä½¿ç”¨äº†æ–‡ä»¶ä½œç”¨åŸŸç±»å‹
- [ ] DTOå’Œäº‹ä»¶ä½¿ç”¨äº† `record`
- [ ] æ–¹æ³•èŒè´£å•ä¸€ä¸”å°å·§
- [ ] ä¸å¯å˜å€¼ç±»å‹ä½¿ç”¨äº† `readonly struct`
- [ ] APIå‚æ•°ä½¿ç”¨äº†éªŒè¯ç‰¹æ€§
- [ ] æ„å»ºæˆåŠŸï¼ˆæ— è­¦å‘Šï¼‰
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡
- [ ] ä»£ç ç¬¦åˆé¡¹ç›®æ¶æ„è§„èŒƒ

## è‡ªåŠ¨åŒ–æ£€æŸ¥è„šæœ¬

å°†ä»¥ä¸‹è„šæœ¬ä¿å­˜ä¸º `check-pr.sh`ï¼Œåœ¨æäº¤å‰è¿è¡Œï¼š

```bash
#!/bin/bash

echo "ğŸ” æ£€æŸ¥UTCæ—¶é—´ä½¿ç”¨..."
UTC_COUNT=$(grep -r "DateTime\.UtcNow\|DateTimeOffset\.UtcNow" --include="*.cs" | grep -v "bin\|obj\|Tests" | wc -l)
if [ $UTC_COUNT -gt 0 ]; then
    echo "âŒ å‘ç° $UTC_COUNT å¤„ä½¿ç”¨UTCæ—¶é—´ï¼Œå¿…é¡»ä¿®å¤ï¼"
    grep -r "DateTime\.UtcNow\|DateTimeOffset\.UtcNow" --include="*.cs" | grep -v "bin\|obj\|Tests"
    exit 1
fi
echo "âœ… æ²¡æœ‰ä½¿ç”¨UTCæ—¶é—´"

echo "ğŸ—ï¸  æ„å»ºé¡¹ç›®..."
dotnet build
if [ $? -ne 0 ]; then
    echo "âŒ æ„å»ºå¤±è´¥"
    exit 1
fi
echo "âœ… æ„å»ºæˆåŠŸ"

echo "ğŸ§ª è¿è¡Œæµ‹è¯•..."
dotnet test --no-build
if [ $? -ne 0 ]; then
    echo "âŒ æµ‹è¯•å¤±è´¥"
    exit 1
fi
echo "âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡"

echo ""
echo "âœ… æ‰€æœ‰æ£€æŸ¥é€šè¿‡ï¼Œå¯ä»¥æäº¤PR"
```

## è¿è§„å¤„ç†

è‹¥PRä¸­æ— æ³•æ»¡è¶³ä»»ä¸€è§„åˆ™ï¼š
1. åœ¨PRæè¿°ä¸­æ˜ç¡®å†™æ˜åŸå› 
2. è¯´æ˜ä¸ºä½•éœ€è¦ä¾‹å¤–
3. è¯·æ±‚äººå·¥ç¡®è®¤å’Œæ‰¹å‡†

**æœªç»æ‰¹å‡†çš„è¿è§„ä»£ç å°†è¢«æ‹’ç»ã€‚**

---

**ç‰ˆæœ¬**ï¼šv1.0  
**æœ€åæ›´æ–°**ï¼š2025-11-21  
**ç»´æŠ¤è€…**ï¼šZakYip Team
