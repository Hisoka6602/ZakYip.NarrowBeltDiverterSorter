# ä»£ç å®¡æŸ¥æ£€æŸ¥æ¸…å• - 7ç±»å½±åˆ†èº«æ£€æµ‹è¡¥å……

æœ¬æ–‡æ¡£æ˜¯ [ä»£ç å®¡æŸ¥æ£€æŸ¥æ¸…å•](./ä»£ç å®¡æŸ¥æ£€æŸ¥æ¸…å•.md.backup) çš„è¡¥å……ï¼Œä¸“é—¨é’ˆå¯¹æ–°å¢çš„7ç±»å½±åˆ†èº«æ£€æµ‹æä¾›è¯¦ç»†çš„äººå·¥å®¡æŸ¥æŒ‡å—ã€‚

> **ğŸ“‹ ä½¿ç”¨è¯´æ˜**ï¼šä¸è‡ªåŠ¨åŒ–æ£€æµ‹è„šæœ¬é…åˆä½¿ç”¨ï¼Œç¡®ä¿ä»£ç è´¨é‡ã€‚è‡ªåŠ¨åŒ–å·¥å…·æ— æ³•æ£€æµ‹çš„è¯­ä¹‰é—®é¢˜éœ€è¦äººå·¥ä»”ç»†å®¡æŸ¥ã€‚

---

## ç›®å½•

1. [æšä¸¾æ£€æŸ¥ (Enum)](#1-æšä¸¾æ£€æŸ¥-enum)
2. [æ¥å£æ£€æŸ¥ (Interface)](#2-æ¥å£æ£€æŸ¥-interface)
3. [DTOæ£€æŸ¥ (DTO)](#3-dtoæ£€æŸ¥-dto)
4. [Optionsæ£€æŸ¥ (Configuration Options)](#4-optionsæ£€æŸ¥-configuration-options)
5. [æ‰©å±•æ–¹æ³•æ£€æŸ¥ (Extension Methods)](#5-æ‰©å±•æ–¹æ³•æ£€æŸ¥-extension-methods)
6. [é™æ€ç±»æ£€æŸ¥ (Static Utility Classes)](#6-é™æ€ç±»æ£€æŸ¥-static-utility-classes)
7. [å¸¸é‡æ£€æŸ¥ (Constants)](#7-å¸¸é‡æ£€æŸ¥-constants)

---

## 1. æšä¸¾æ£€æŸ¥ (Enum)

### è‡ªåŠ¨åŒ–æ£€æµ‹
```bash
# è¿è¡Œå½±åˆ†èº«æ£€æµ‹è„šæœ¬
./scripts/detect-shadow-clones.sh
```

### äººå·¥æ£€æŸ¥è¦ç‚¹

#### âœ… è¯­ä¹‰é‡å¤æ£€æŸ¥
æ£€æŸ¥ä¸åŒåç§°çš„æšä¸¾æ˜¯å¦è¡¨ç¤ºç›¸åŒçš„æ¦‚å¿µï¼š

**å¸¸è§é‡å¤æ¨¡å¼**ï¼š
- `Status` vs `State` - çŠ¶æ€ç›¸å…³
- `Type` vs `Kind` - ç±»å‹åˆ†ç±»
- `Mode` vs `Style` - æ¨¡å¼é£æ ¼
- `Level` vs `Priority` - ç­‰çº§ä¼˜å…ˆçº§

**ç¤ºä¾‹**ï¼š
```csharp
// âš ï¸ å¯èƒ½çš„è¯­ä¹‰é‡å¤
public enum OrderStatus
{
    Pending,
    Processing,
    Completed
}

public enum OrderState  // ä¸ OrderStatus è¯­ä¹‰é‡å¤ï¼Ÿ
{
    Waiting,
    InProgress,
    Done
}
```

**æ£€æŸ¥æ­¥éª¤**ï¼š
1. åˆ—å‡ºæ‰€æœ‰æšä¸¾ç±»å‹
2. å¯¹æ¯”æšä¸¾å€¼çš„è¯­ä¹‰
3. è¯„ä¼°æ˜¯å¦å¯ä»¥åˆå¹¶
4. å¦‚æœä¸èƒ½åˆå¹¶ï¼Œç¡®ä¿å‘½åæ¸…æ™°åŒºåˆ†

#### âœ… Description ç‰¹æ€§æ£€æŸ¥
æ‰€æœ‰æšä¸¾å€¼å¿…é¡»æ·»åŠ  `[Description]` ç‰¹æ€§ï¼ˆé¡¹ç›®è§„èŒƒï¼‰ï¼š

```csharp
// âœ… æ­£ç¡®
public enum OrderStatus
{
    [Description("ç­‰å¾…å¤„ç†")]
    Pending,
    
    [Description("å¤„ç†ä¸­")]
    Processing,
    
    [Description("å·²å®Œæˆ")]
    Completed
}

// âŒ é”™è¯¯ï¼šç¼ºå°‘ Description ç‰¹æ€§
public enum OrderStatus
{
    Pending,      // ç¼ºå°‘ç‰¹æ€§
    Processing,   // ç¼ºå°‘ç‰¹æ€§
    Completed     // ç¼ºå°‘ç‰¹æ€§
}
```

#### âœ… å‘½åä¸€è‡´æ€§æ£€æŸ¥
- [ ] ä½¿ç”¨å•æ•°å½¢å¼ï¼ˆ`OrderStatus` è€Œé `OrderStatuses`ï¼‰
- [ ] æšä¸¾å€¼ä½¿ç”¨ PascalCase
- [ ] æšä¸¾ç±»å‹åç§°å…·æœ‰æè¿°æ€§
- [ ] é¿å…ä½¿ç”¨ç¼©å†™ï¼ˆé™¤éæ˜¯é€šç”¨ç¼©å†™ï¼‰

#### âœ… åˆå¹¶æœºä¼šè¯„ä¼°
**åˆå¹¶æ¡ä»¶**ï¼š
- æšä¸¾å€¼è¯­ä¹‰ç›¸ä¼¼åº¦ > 80%
- åœ¨ç›¸åŒçš„ä¸šåŠ¡ä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨
- åˆå¹¶ä¸ä¼šç ´åç°æœ‰ä»£ç 

**åˆå¹¶æ­¥éª¤**ï¼š
1. ç¡®å®šä¿ç•™å“ªä¸ªæšä¸¾ï¼ˆé€šå¸¸é€‰æ‹©å‘½åæ›´æ¸…æ™°çš„ï¼‰
2. æ›´æ–°æ‰€æœ‰å¼•ç”¨
3. åˆ é™¤é‡å¤å®šä¹‰
4. æ›´æ–°ç›¸å…³æµ‹è¯•å’Œæ–‡æ¡£

**æŠ€æœ¯å€ºåŠ¡è®°å½•**ï¼š
å¦‚æœå‘ç°é‡å¤ä½†æš‚æ—¶æ— æ³•åˆå¹¶ï¼š
- è®°å½•åˆ° [æŠ€æœ¯å€ºåŠ¡æ–‡æ¡£](./æŠ€æœ¯å€ºåŠ¡.md)
- ç¼–å·æ ¼å¼ï¼š`TD-CLONE-ENUM-NNN`
- è¯´æ˜æ— æ³•åˆå¹¶çš„åŸå› å’Œè®¡åˆ’

---

## 2. æ¥å£æ£€æŸ¥ (Interface)

### è‡ªåŠ¨åŒ–æ£€æµ‹
è„šæœ¬ä¼šæ£€æµ‹é‡å¤çš„æ¥å£åç§°ï¼Œä½†æ— æ³•æ£€æµ‹è¯­ä¹‰é‡å¤å’Œæ–¹æ³•ç­¾åé‡å ã€‚

### äººå·¥æ£€æŸ¥è¦ç‚¹

#### âœ… æ–¹æ³•ç­¾åé‡å æ£€æŸ¥
æ£€æŸ¥ä¸åŒæ¥å£æ˜¯å¦æœ‰ç›¸åŒæˆ–é«˜åº¦ç›¸ä¼¼çš„æ–¹æ³•ç­¾åï¼š

```csharp
// âš ï¸ æ–¹æ³•ç­¾åé‡å 
public interface IDataReader
{
    Task<Data> ReadAsync(int id);
    Task<List<Data>> ReadAllAsync();
}

public interface IDataRetriever
{
    Task<Data> ReadAsync(int id);      // å®Œå…¨ç›¸åŒ
    Task<List<Data>> GetAllAsync();    // ä»…åç§°ä¸åŒ
}
```

**é‡å åº¦è¯„ä¼°**ï¼š
- 100% é‡å ï¼šç«‹å³åˆå¹¶
- 50-99% é‡å ï¼šè¯„ä¼°åˆå¹¶å¯è¡Œæ€§
- < 50% é‡å ï¼šæ£€æŸ¥æ˜¯å¦å‘½åæ··æ·†

#### âœ… èŒè´£å•ä¸€æ€§æ£€æŸ¥
æ¯ä¸ªæ¥å£åº”è¯¥ä»£è¡¨ä¸€ä¸ªæ¸…æ™°çš„èƒ½åŠ›æˆ–èŒè´£ï¼š

```csharp
// âŒ é”™è¯¯ï¼š"ä¸Šå¸æ¥å£"ï¼ŒèŒè´£ä¸å•ä¸€
public interface IDataManager
{
    Task ReadAsync();
    Task WriteAsync();
    Task DeleteAsync();
    Task ValidateAsync();
    Task TransformAsync();
    Task LogAsync();
}

// âœ… æ­£ç¡®ï¼šæ‹†åˆ†ä¸ºå¤šä¸ªæ¥å£
public interface IDataReader
{
    Task<Data> ReadAsync(int id);
}

public interface IDataWriter
{
    Task WriteAsync(Data data);
}

public interface IDataValidator
{
    Task<bool> ValidateAsync(Data data);
}
```

#### âœ… å‘½åè§„èŒƒæ£€æŸ¥
- [ ] æ¥å£åç§°ä»¥ `I` å¼€å¤´
- [ ] ä½¿ç”¨å½¢å®¹è¯æˆ–èƒ½åŠ›æè¿°ï¼ˆå¦‚ `IReadable`ã€`IConnectable`ï¼‰
- [ ] é¿å…ä½¿ç”¨æ³›åŒ–åç§°ï¼ˆ`Manager`ã€`Helper`ã€`Service`ï¼‰
- [ ] åç§°åº”è¯¥åæ˜ æ¥å£çš„æ ¸å¿ƒèŒè´£

#### âœ… æŠ½è±¡å±‚çº§æ£€æŸ¥
æ¥å£åº”è¯¥åœ¨æ­£ç¡®çš„å±‚çº§å®šä¹‰ï¼š

| å±‚çº§ | æ¥å£ç±»å‹ | ç¤ºä¾‹ |
|------|----------|------|
| Core | é¢†åŸŸæ¥å£ | `IParcelRepository`, `IRoutingEngine` |
| Drivers | ç¡¬ä»¶æŠ½è±¡æ¥å£ | `IMainLineDrive`, `IChuteController` |
| Infrastructure | åŸºç¡€è®¾æ–½æ¥å£ | `IConfigurationStore`, `IEventBus` |

#### âœ… ä¾èµ–æ–¹å‘æ£€æŸ¥
ç¡®ä¿ä¾èµ–æ–¹å‘æ­£ç¡®ï¼š
- ä¾èµ–åº”è¯¥æŒ‡å‘æŠ½è±¡è€Œéå…·ä½“å®ç°
- é¿å…å¾ªç¯ä¾èµ–
- Core å±‚æ¥å£ä¸åº”è¯¥ä¾èµ–å¤–éƒ¨å±‚

**æŠ€æœ¯å€ºåŠ¡è®°å½•**ï¼š
- é‡å¤æ¥å£è®°å½•ä¸º `TD-CLONE-INTERFACE-NNN`
- èŒè´£ä¸å•ä¸€è®°å½•ä¸º `TD-ARCH-INTERFACE-NNN`

---

## 3. DTOæ£€æŸ¥ (DTO)

### è‡ªåŠ¨åŒ–æ£€æµ‹
è„šæœ¬æ£€æµ‹åç§°é‡å¤ï¼Œä½†æ— æ³•æ£€æµ‹å­—æ®µç»“æ„ç›¸ä¼¼åº¦ã€‚

### äººå·¥æ£€æŸ¥è¦ç‚¹

#### âœ… å­—æ®µç»“æ„ç›¸ä¼¼åº¦æ£€æŸ¥
å¯¹æ¯”ä¸åŒ DTO çš„å­—æ®µç»“æ„ï¼š

```csharp
// âš ï¸ å­—æ®µç»“æ„é«˜åº¦ç›¸ä¼¼ï¼ˆç›¸ä¼¼åº¦ > 80%ï¼‰
public record UserDto(long Id, string Name, string Email, DateTime CreatedAt);
public record UserInfo(long Id, string Name, string Email, DateTime JoinedAt);

// ä»…å­—æ®µåç§°ä¸åŒï¼Œåº”è€ƒè™‘åˆå¹¶
```

**ç›¸ä¼¼åº¦è®¡ç®—**ï¼š
```
ç›¸ä¼¼åº¦ = (ç›¸åŒå­—æ®µæ•° / æ€»å­—æ®µæ•°) Ã— 100%
```

**åˆå¹¶ç­–ç•¥**ï¼š
- 100% ç›¸åŒï¼šç«‹å³åˆå¹¶
- 80-99% ç›¸åŒï¼šè¯„ä¼°è¯­ä¹‰å·®å¼‚ï¼Œè€ƒè™‘åˆå¹¶
- 50-79% ç›¸åŒï¼šè¯„ä¼°æ˜¯å¦å¯ä»¥ä½¿ç”¨ç»§æ‰¿æˆ–ç»„åˆ
- < 50% ç›¸åŒï¼šä¿æŒç‹¬ç«‹

#### âœ… å‘½åçº¦å®šæ£€æŸ¥
- [ ] ä½¿ç”¨ `record` ç±»å‹ï¼ˆä¸å¯å˜æ•°æ®ï¼‰
- [ ] åç§°ä»¥ `Dto` ç»“å°¾
- [ ] ä½¿ç”¨æ¸…æ™°çš„ä¸šåŠ¡æœ¯è¯­
- [ ] é¿å…ä½¿ç”¨æŠ€æœ¯æœ¯è¯­ä½œä¸º DTO åç§°

```csharp
// âœ… æ­£ç¡®
public record UserProfileDto(long Id, string Name);
public record OrderSummaryDto(long OrderId, decimal Total);

// âŒ é”™è¯¯
public record UserData(long Id, string Name);      // åº”è¯¥ç”¨ Dto ç»“å°¾
public record EntityDto(long Id);                  // åç§°å¤ªæ³›åŒ–
```

#### âœ… ä¸å¯å˜æ€§æ£€æŸ¥
DTO åº”è¯¥æ˜¯ä¸å¯å˜çš„ï¼š

```csharp
// âœ… æ­£ç¡®ï¼šä½¿ç”¨ record å’Œ init
public record UserDto
{
    public required long Id { get; init; }
    public required string Name { get; init; }
    public string? Email { get; init; }  // å¯é€‰
}

// âŒ é”™è¯¯ï¼šä½¿ç”¨ setï¼ˆå¯å˜ï¼‰
public record UserDto
{
    public long Id { get; set; }      // åº”è¯¥ç”¨ init
    public string Name { get; set; }  // åº”è¯¥ç”¨ init
}

// âŒ é”™è¯¯ï¼šä½¿ç”¨ class è€Œé record
public class UserDto  // åº”è¯¥ç”¨ record
{
    public long Id { get; init; }
    public string Name { get; init; }
}
```

#### âœ… è§„èŒƒä½ç½®æ£€æŸ¥
DTO åº”è¯¥å®šä¹‰åœ¨æ­£ç¡®çš„ä½ç½®ï¼š

| ç”¨é€” | ä½ç½® | ç¤ºä¾‹ |
|------|------|------|
| API å¥‘çº¦ | `Contracts` å±‚ | `Host.Contracts.SignalR/LiveViewDtos.cs` |
| å†…éƒ¨ä¼ è¾“ | `Core` æˆ–ç›¸åº”å±‚ | `Core/Domain/ParcelDto.cs` |
| äº‹ä»¶è½½è· | `Observability.Events` | `Observability.Events/ParcelCreatedEventArgs.cs` |

**ç¦æ­¢**ï¼š
- âŒ åœ¨å¤šä¸ªå‘½åç©ºé—´é‡å¤å®šä¹‰ç›¸åŒçš„ DTO
- âŒ åœ¨ Host å±‚å®šä¹‰ä¸šåŠ¡ DTO

#### âœ… å¿…å¡«å±æ€§æ£€æŸ¥
å¿…å¡«å±æ€§å¿…é¡»ä½¿ç”¨ `required` å…³é”®å­—ï¼š

```csharp
// âœ… æ­£ç¡®
public record UserDto
{
    public required long Id { get; init; }
    public required string Name { get; init; }
    public string? Email { get; init; }  // å¯é€‰ï¼Œä½¿ç”¨ nullable
}

// âŒ é”™è¯¯ï¼šç¼ºå°‘ required
public record UserDto
{
    public long Id { get; init; }      // åº”è¯¥ required
    public string Name { get; init; }  // åº”è¯¥ required
    public string? Email { get; init; }
}
```

**æŠ€æœ¯å€ºåŠ¡è®°å½•**ï¼š
- é‡å¤ DTO è®°å½•ä¸º `TD-CLONE-DTO-NNN`

---

## 4. Optionsæ£€æŸ¥ (Configuration Options)

### è‡ªåŠ¨åŒ–æ£€æµ‹
æ£€æµ‹è·¨å‘½åç©ºé—´çš„ Options ç±»é‡å¤ã€‚

### äººå·¥æ£€æŸ¥è¦ç‚¹

#### âœ… å‘½åç©ºé—´æ£€æŸ¥
é…ç½®ç±»ä¸åº”è¯¥åœ¨å¤šä¸ªå‘½åç©ºé—´ä¸­å®šä¹‰ï¼š

```csharp
// âŒ é”™è¯¯ï¼šè·¨å‘½åç©ºé—´é‡å¤
namespace Core.Configuration
{
    public class DatabaseOptions { ... }
}

namespace Infrastructure.Configuration
{
    public class DatabaseOptions { ... }  // é‡å¤å®šä¹‰
}
```

#### âœ… è§„èŒƒä½ç½®æ£€æŸ¥
é…ç½®ç±»åº”è¯¥å®šä¹‰åœ¨æ­£ç¡®çš„ä½ç½®ï¼š

| é…ç½®èŒƒå›´ | æ¨èä½ç½® | ç¤ºä¾‹ |
|----------|----------|------|
| å…¨å±€é…ç½® | `Core.Configuration` æˆ– `Shared` | `SystemOptions`, `LoggingOptions` |
| æ¨¡å—é…ç½® | å¯¹åº”æ¨¡å—å‘½åç©ºé—´ | `Communication.UpstreamOptions` |
| é©±åŠ¨é…ç½® | `Drivers` å±‚ | `Drivers.Rema.RemaLm1000HOptions` |

**ç¦æ­¢**ï¼š
- âŒ åœ¨ Host å±‚å®šä¹‰é…ç½®ç±»ï¼ˆåº”è¯¥åœ¨ Core æˆ–å¯¹åº”å±‚ï¼‰
- âŒ åœ¨å¤šä¸ªå±‚é‡å¤å®šä¹‰ç›¸åŒé…ç½®

#### âœ… å‘½åçº¦å®šæ£€æŸ¥
- [ ] é…ç½®ç±»åç§°ä»¥ `Options` ç»“å°¾
- [ ] ä½¿ç”¨æ¸…æ™°çš„æè¿°æ€§åç§°
- [ ] é¿å…ä½¿ç”¨ç®€ç§°ï¼ˆé™¤éæ˜¯é€šç”¨ç®€ç§°ï¼‰

```csharp
// âœ… æ­£ç¡®
public class DatabaseConnectionOptions { ... }
public class RetryPolicyOptions { ... }
public class LogRetentionOptions { ... }

// âŒ é”™è¯¯
public class DbOpts { ... }          // åç§°å¤ªç®€çŸ­
public class Settings { ... }        // ä¸å¤Ÿå…·ä½“
public class Configuration { ... }   // å¤ªæ³›åŒ–
```

#### âœ… å±æ€§éªŒè¯æ£€æŸ¥
é…ç½®ç±»åº”è¯¥ä½¿ç”¨éªŒè¯ç‰¹æ€§ï¼š

```csharp
// âœ… æ­£ç¡®ï¼šä½¿ç”¨éªŒè¯ç‰¹æ€§å’Œé»˜è®¤å€¼
public class RetryOptions
{
    [Range(1, 10, ErrorMessage = "é‡è¯•æ¬¡æ•°å¿…é¡»åœ¨ 1-10 ä¹‹é—´")]
    public int MaxRetries { get; set; } = 3;
    
    [Range(100, 60000, ErrorMessage = "é‡è¯•å»¶è¿Ÿå¿…é¡»åœ¨ 100-60000 æ¯«ç§’ä¹‹é—´")]
    public int RetryDelayMs { get; set; } = 1000;
    
    [Range(1, 10, ErrorMessage = "é€€é¿å€æ•°å¿…é¡»åœ¨ 1-10 ä¹‹é—´")]
    public double BackoffMultiplier { get; set; } = 2.0;
}

// âŒ é”™è¯¯ï¼šç¼ºå°‘éªŒè¯å’Œé»˜è®¤å€¼
public class RetryOptions
{
    public int MaxRetries { get; set; }      // ç¼ºå°‘éªŒè¯å’Œé»˜è®¤å€¼
    public int RetryDelayMs { get; set; }    // ç¼ºå°‘éªŒè¯å’Œé»˜è®¤å€¼
}
```

#### âœ… é…ç½®ç»‘å®šæ£€æŸ¥
ç¡®ä¿é…ç½®ç±»æ­£ç¡®ä½¿ç”¨ `IOptions<T>` æ¨¡å¼ï¼š

```csharp
// âœ… æ­£ç¡®ï¼šä½¿ç”¨ IOptions<T>
public class MyService
{
    private readonly MyOptions _options;
    
    public MyService(IOptions<MyOptions> options)
    {
        _options = options.Value;
    }
}

// âœ… ä¹Ÿæ­£ç¡®ï¼šä½¿ç”¨ IOptionsSnapshot<T>ï¼ˆæ”¯æŒçƒ­æ›´æ–°ï¼‰
public class MyService
{
    private readonly IOptionsSnapshot<MyOptions> _options;
    
    public MyService(IOptionsSnapshot<MyOptions> options)
    {
        _options = options;
    }
    
    public void DoWork()
    {
        var currentOptions = _options.Value;  // æ¯æ¬¡è·å–æœ€æ–°å€¼
    }
}

// âŒ é”™è¯¯ï¼šç›´æ¥ä¾èµ–é…ç½®ç±»
public class MyService
{
    public MyService(MyOptions options)  // åº”è¯¥ç”¨ IOptions<MyOptions>
    {
        // ...
    }
}
```

#### âœ… API ç«¯ç‚¹æ£€æŸ¥
å¿…é¡»é…ç½®åº”è¯¥æœ‰ API ç«¯ç‚¹æ”¯æŒè¿è¡Œæ—¶ä¿®æ”¹ï¼š

```csharp
// âœ… æ¨èï¼šæä¾› API ç«¯ç‚¹
[ApiController]
[Route("api/config")]
public class ConfigurationController : ControllerBase
{
    [HttpGet("retry")]
    public IActionResult GetRetryConfig()
    {
        // è¿”å›å½“å‰é…ç½®
    }
    
    [HttpPost("retry")]
    public IActionResult UpdateRetryConfig([FromBody] RetryOptions options)
    {
        // éªŒè¯å¹¶æ›´æ–°é…ç½®
    }
}
```

**æŠ€æœ¯å€ºåŠ¡è®°å½•**ï¼š
- é‡å¤ Options è®°å½•ä¸º `TD-CLONE-OPTIONS-NNN`
- ç¼ºå°‘ API ç«¯ç‚¹è®°å½•ä¸º `TD-CONFIG-API-NNN`

---

## 5. æ‰©å±•æ–¹æ³•æ£€æŸ¥ (Extension Methods)

### è‡ªåŠ¨åŒ–æ£€æµ‹
æ£€æµ‹ç›¸åŒç­¾åçš„æ‰©å±•æ–¹æ³•ï¼ˆæ–¹æ³•å + ç›®æ ‡ç±»å‹ï¼‰ã€‚

### äººå·¥æ£€æŸ¥è¦ç‚¹

#### âœ… ç­¾åå”¯ä¸€æ€§æ£€æŸ¥
æ£€æŸ¥ä¸åŒé™æ€ç±»ä¸­æ˜¯å¦æœ‰ç›¸åŒç­¾åçš„æ‰©å±•æ–¹æ³•ï¼š

```csharp
// âŒ ç­¾åé‡å¤
namespace Utilities
{
    public static class StringExtensions
    {
        public static bool IsNullOrEmpty(this string? value)
            => string.IsNullOrEmpty(value);
    }
}

namespace Helpers
{
    public static class StringHelpers
    {
        public static bool IsNullOrEmpty(this string? value)  // é‡å¤
            => string.IsNullOrEmpty(value);
    }
}
```

**ç­¾åå®šä¹‰**ï¼š
```
ç­¾å = æ–¹æ³•å + this å‚æ•°ç±»å‹
ä¾‹å¦‚ï¼šIsNullOrEmpty(string) æ˜¯ä¸€ä¸ªç­¾å
```

#### âœ… å‘½åçº¦å®šæ£€æŸ¥
- [ ] æ‰©å±•æ–¹æ³•ç±»åä»¥ `Extensions` ç»“å°¾
- [ ] æ–¹æ³•åæ¸…æ™°æè¿°åŠŸèƒ½
- [ ] ä½¿ç”¨é€‚å½“çš„å‘½åç©ºé—´

```csharp
// âœ… æ­£ç¡®
namespace ZakYip.Shared.Extensions
{
    public static class StringExtensions
    {
        public static bool IsNullOrEmpty(this string? value) { ... }
    }
}

// âŒ é”™è¯¯
namespace Utilities
{
    public static class StringHelper  // åº”è¯¥ç”¨ Extensions ç»“å°¾
    {
        public static bool Check(this string? value) { ... }  // åç§°ä¸å¤Ÿæ¸…æ™°
    }
}
```

#### âœ… æ”¾ç½®ä½ç½®æ£€æŸ¥
æ‰©å±•æ–¹æ³•åº”è¯¥æ”¾åœ¨æ­£ç¡®çš„ä½ç½®ï¼š

| æ‰©å±•ç±»å‹ | æ¨èä½ç½® | ç¤ºä¾‹ |
|----------|----------|------|
| é€šç”¨æ‰©å±• | `Shared` å±‚ | `Shared/Extensions/StringExtensions.cs` |
| é¢†åŸŸæ‰©å±• | `Core` å±‚ | `Core/Extensions/ParcelExtensions.cs` |
| ç‰¹å®šåŠŸèƒ½æ‰©å±• | å¯¹åº”æ¨¡å— | `Execution/Extensions/VectorExtensions.cs` |

#### âœ… this å‚æ•°ç±»å‹æ£€æŸ¥
é¿å…æ‰©å±•è¿‡äºæ³›åŒ–çš„ç±»å‹ï¼š

```csharp
// âš ï¸ é¿å…ï¼šæ‰©å±• objectï¼ˆè¿‡äºæ³›åŒ–ï¼‰
public static class ObjectExtensions
{
    public static bool IsNull(this object? obj) => obj == null;
}

// âœ… æ¨èï¼šæ‰©å±•æ¥å£
public static class EnumerableExtensions
{
    public static bool IsEmpty<T>(this IEnumerable<T> source)
        => !source.Any();
}

// âœ… æ¨èï¼šæ‰©å±•å…·ä½“ç±»å‹
public static class StringExtensions
{
    public static bool IsNullOrEmpty(this string? value)
        => string.IsNullOrEmpty(value);
}
```

#### âœ… ç©ºå€¼å¤„ç†æ£€æŸ¥
æ‰©å±•æ–¹æ³•å¿…é¡»æ­£ç¡®å¤„ç† nullï¼š

```csharp
// âœ… æ­£ç¡®ï¼šæ£€æŸ¥ null
public static bool IsNullOrEmpty<T>(this IEnumerable<T>? source)
{
    return source == null || !source.Any();
}

// âœ… æ­£ç¡®ï¼šä½¿ç”¨ nullable
public static string ToUpperOrEmpty(this string? value)
{
    return value?.ToUpper() ?? string.Empty;
}

// âŒ é”™è¯¯ï¼šä¸æ£€æŸ¥ nullï¼Œå¯èƒ½æŠ› NullReferenceException
public static bool IsEmpty<T>(this IEnumerable<T> source)
{
    return !source.Any();  // å¦‚æœ source ä¸º null ä¼šæŠ›å¼‚å¸¸
}
```

#### âœ… åˆå¹¶ç­–ç•¥
ç›¸åŒç­¾åçš„æ‰©å±•æ–¹æ³•åº”è¯¥åˆå¹¶ï¼š

**åˆå¹¶æ­¥éª¤**ï¼š
1. é€‰æ‹©ä¿ç•™ä½ç½®ï¼ˆé€šå¸¸æ˜¯ Shared å±‚ï¼‰
2. åˆå¹¶å®ç°ï¼ˆé€‰æ‹©æ›´å®Œå–„çš„å®ç°ï¼‰
3. æ›´æ–°æ‰€æœ‰å¼•ç”¨
4. åˆ é™¤é‡å¤å®šä¹‰
5. è¿è¡Œæµ‹è¯•éªŒè¯

**æŠ€æœ¯å€ºåŠ¡è®°å½•**ï¼š
- é‡å¤æ‰©å±•æ–¹æ³•è®°å½•ä¸º `TD-CLONE-EXTENSION-NNN`

---

## 6. é™æ€ç±»æ£€æŸ¥ (Static Utility Classes)

### è‡ªåŠ¨åŒ–æ£€æµ‹
æ£€æµ‹é‡å¤çš„é™æ€ç±»åç§°ã€‚

### äººå·¥æ£€æŸ¥è¦ç‚¹

#### âœ… åŠŸèƒ½é‡å¤æ£€æŸ¥
æ£€æŸ¥ä¸åŒé™æ€ç±»æ˜¯å¦æä¾›ç›¸åŒçš„åŠŸèƒ½ï¼š

```csharp
// âš ï¸ åŠŸèƒ½é‡å¤
public static class StringHelper
{
    public static bool IsEmpty(string value)
        => string.IsNullOrEmpty(value);
    
    public static string Truncate(string value, int length) { ... }
}

public static class StringUtil
{
    public static bool IsEmpty(string value)  // é‡å¤
        => string.IsNullOrEmpty(value);
    
    public static string Shorten(string value, int length) { ... }  // åŠŸèƒ½ç›¸åŒï¼Œåç§°ä¸åŒ
}
```

**åŠŸèƒ½é‡å¤åº¦è¯„ä¼°**ï¼š
- æ–¹æ³•åå’Œå‚æ•°å®Œå…¨ç›¸åŒï¼š100% é‡å¤
- æ–¹æ³•åä¸åŒä½†åŠŸèƒ½ç›¸åŒï¼šè¯­ä¹‰é‡å¤
- æ–¹æ³•å‚æ•°ä¸åŒä½†å¯ä»¥åˆå¹¶ï¼šå¯åˆå¹¶é‡å¤

#### âœ… å‘½åè§„èŒƒæ£€æŸ¥
- [ ] é¿å…ä½¿ç”¨ `Helper`ã€`Util`ã€`Utils` ç­‰æ³›åŒ–åç§°
- [ ] ä½¿ç”¨æè¿°æ€§åç§°åæ˜ èŒè´£
- [ ] é™æ€ç±»å¿…é¡»ç”¨ `static` å…³é”®å­—æ ‡è®°

```csharp
// âœ… æ­£ç¡®ï¼šæè¿°æ€§åç§°
public static class PhysicsConversion
{
    public static double MmpsToMps(double mmps) => mmps / 1000.0;
}

public static class DateTimeFormatter
{
    public static string ToIso8601(DateTime dateTime) { ... }
}

// âŒ é”™è¯¯ï¼šæ³›åŒ–åç§°
public static class Helper      // å¤ªæ³›åŒ–
{
    public static double Convert(double value) { ... }
}

public static class Util        // å¤ªæ³›åŒ–
{
    public static string Format(DateTime dt) { ... }
}
```

#### âœ… èŒè´£å•ä¸€æ€§æ£€æŸ¥
æ¯ä¸ªå·¥å…·ç±»åº”è¯¥èŒè´£å•ä¸€ï¼š

```csharp
// âŒ é”™è¯¯ï¼š"ä¸‡èƒ½å·¥å…·ç±»"
public static class CommonHelper
{
    public static bool ValidateEmail(string email) { ... }
    public static double CalculateDistance(double x, double y) { ... }
    public static string FormatDate(DateTime date) { ... }
    public static int ParseInteger(string value) { ... }
}

// âœ… æ­£ç¡®ï¼šæ‹†åˆ†ä¸ºå¤šä¸ªèŒè´£å•ä¸€çš„ç±»
public static class EmailValidator
{
    public static bool IsValid(string email) { ... }
}

public static class DistanceCalculator
{
    public static double Calculate(double x, double y) { ... }
}

public static class DateFormatter
{
    public static string Format(DateTime date) { ... }
}
```

#### âœ… ä¼˜å…ˆä½¿ç”¨æ‰©å±•æ–¹æ³•
è¯„ä¼°æ˜¯å¦åº”è¯¥æ”¹ä¸ºæ‰©å±•æ–¹æ³•ï¼š

```csharp
// âŒ ä¸æ¨èï¼šé™æ€æ–¹æ³•
public static class StringHelper
{
    public static bool IsEmpty(string value)
        => string.IsNullOrEmpty(value);
}
// ä½¿ç”¨ï¼šStringHelper.IsEmpty(myString)

// âœ… æ¨èï¼šæ‰©å±•æ–¹æ³•
public static class StringExtensions
{
    public static bool IsEmpty(this string? value)
        => string.IsNullOrEmpty(value);
}
// ä½¿ç”¨ï¼šmyString.IsEmpty()  æ›´è‡ªç„¶
```

**ä½¿ç”¨æ‰©å±•æ–¹æ³•çš„åœºæ™¯**ï¼š
- æ–¹æ³•ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¢«æ“ä½œçš„å¯¹è±¡
- æ–¹æ³•æ˜¯å¯¹è¯¥ç±»å‹çš„"æ‰©å±•"åŠŸèƒ½
- è°ƒç”¨æ–¹å¼ `obj.Method()` æ¯” `Helper.Method(obj)` æ›´è‡ªç„¶

**ä½¿ç”¨é™æ€æ–¹æ³•çš„åœºæ™¯**ï¼š
- çº¯ç²¹çš„å·¥å…·å‡½æ•°ï¼ˆå¦‚æ•°å­¦è®¡ç®—ï¼‰
- æ²¡æœ‰æ˜ç¡®çš„"è¢«æ‰©å±•ç±»å‹"
- å·¥å‚æ–¹æ³•
- è½¬æ¢å‡½æ•°ï¼ˆå¤šä¸ªå‚æ•°ï¼‰

#### âœ… æ–‡ä»¶ä½œç”¨åŸŸæ£€æŸ¥
å†…éƒ¨å·¥å…·ç±»åº”è¯¥ä½¿ç”¨ `file` å…³é”®å­—ï¼š

```csharp
// âœ… æ­£ç¡®ï¼šå†…éƒ¨å·¥å…·ç±»ä½¿ç”¨ file ä½œç”¨åŸŸ
file static class InternalCalculator
{
    public static int Add(int x, int y) => x + y;
}

// åªåœ¨å½“å‰æ–‡ä»¶å¯è§ï¼Œä¸æ±¡æŸ“å‘½åç©ºé—´
```

**æŠ€æœ¯å€ºåŠ¡è®°å½•**ï¼š
- é‡å¤é™æ€ç±»è®°å½•ä¸º `TD-CLONE-STATIC-NNN`
- èŒè´£ä¸å•ä¸€è®°å½•ä¸º `TD-ARCH-STATIC-NNN`

---

## 7. å¸¸é‡æ£€æŸ¥ (Constants)

### è‡ªåŠ¨åŒ–æ£€æµ‹
æ£€æµ‹ç›¸åŒå€¼çš„å¸¸é‡å®šä¹‰ï¼ˆè¶…è¿‡5ä¸ªæ—¶è­¦å‘Šï¼‰ã€‚

### äººå·¥æ£€æŸ¥è¦ç‚¹

#### âœ… å€¼é‡å¤æ£€æŸ¥
æ£€æŸ¥ä¸åŒä½ç½®æ˜¯å¦å®šä¹‰äº†ç›¸åŒå€¼çš„å¸¸é‡ï¼š

```csharp
// âš ï¸ å€¼é‡å¤
public class ModuleA
{
    private const int MaxRetries = 3;
    private const int DefaultTimeout = 30;
}

public class ModuleB
{
    private const int MaxRetries = 3;      // å€¼é‡å¤
    private const int DefaultTimeout = 30;  // å€¼é‡å¤
}
```

**é‡å¤è¯„ä¼°**ï¼š
- å®Œå…¨ç›¸åŒçš„å€¼ï¼ˆå¦‚ `3`ã€`"config"`ï¼‰
- ç›¸åŒç”¨é€”çš„å€¼ï¼ˆå¦‚éƒ½è¡¨ç¤ºè¶…æ—¶æ—¶é—´ï¼‰
- è¯„ä¼°æ˜¯å¦åº”è¯¥å…±äº«å®šä¹‰

#### âœ… å‘½åçº¦å®šæ£€æŸ¥
- [ ] å¸¸é‡åä½¿ç”¨ PascalCase
- [ ] åç§°æ¸…æ™°æè¿°ç”¨é€”
- [ ] é¿å…"é­”æ³•æ•°å­—"

```csharp
// âœ… æ­£ç¡®ï¼šæ¸…æ™°çš„å‘½å
private const int DefaultTimeoutSeconds = 30;
private const string ConfigurationKeyPrefix = "App:";
private const int MaxConnectionRetries = 3;
private const double PiValue = 3.14159265359;

// âŒ é”™è¯¯ï¼šä¸æ¸…æ™°çš„å‘½å
private const int Max = 100;           // æœ€å¤§ä»€ä¹ˆï¼Ÿ
private const string Key = "k";        // ä»€ä¹ˆé”®ï¼Ÿ
private const int Timeout = 30;        // å•ä½æ˜¯ä»€ä¹ˆï¼Ÿ
private const int N = 3;               // N ä»£è¡¨ä»€ä¹ˆï¼Ÿ
```

#### âœ… é›†ä¸­ç®¡ç†æ£€æŸ¥
å¸¸ç”¨å¸¸é‡åº”è¯¥é›†ä¸­å®šä¹‰ï¼š

```csharp
// âœ… æ¨èï¼šé›†ä¸­å®šä¹‰åœ¨ Constants ç±»
public static class SystemConstants
{
    // é‡è¯•ç›¸å…³
    public const int MaxRetries = 3;
    public const int RetryDelayMs = 1000;
    public const int MaxBackoffDelayMs = 2000;
    
    // è¶…æ—¶ç›¸å…³
    public const int DefaultTimeoutSeconds = 30;
    public const int ConnectionTimeoutSeconds = 10;
    
    // ç¼“å†²åŒºç›¸å…³
    public const int DefaultBufferSize = 8192;
    public const int MaxBufferSize = 65536;
}

// âŒ ä¸æ¨èï¼šåˆ†æ•£å®šä¹‰
public class ServiceA
{
    private const int MaxRetries = 3;  // åˆ†æ•£
}

public class ServiceB
{
    private const int MaxRetries = 3;  // é‡å¤
}
```

#### âœ… é…ç½® vs å¸¸é‡æ£€æŸ¥
è¯„ä¼°æ˜¯å¦åº”è¯¥æ”¹ä¸ºé…ç½®é¡¹ï¼š

**ä½¿ç”¨å¸¸é‡çš„åœºæ™¯**ï¼š
- ç¼–è¯‘æ—¶ç¡®å®šçš„å€¼
- æ°¸è¿œä¸ä¼šæ”¹å˜çš„å€¼
- æ•°å­¦å¸¸æ•°ã€ç‰©ç†å¸¸æ•°
- åè®®è§„å®šçš„å›ºå®šå€¼

**ä½¿ç”¨é…ç½®çš„åœºæ™¯**ï¼š
- è¿è¡Œæ—¶å¯èƒ½å˜åŒ–çš„å€¼
- ç¯å¢ƒç›¸å…³çš„å€¼
- ä¸šåŠ¡è§„åˆ™ç›¸å…³çš„å€¼

```csharp
// âŒ ä¸æ¨èï¼šåº”è¯¥ä½¿ç”¨é…ç½®
private const string DatabaseServer = "localhost";
private const int MaxConnections = 100;
private const string LogLevel = "Debug";

// âœ… æ¨èï¼šä½¿ç”¨é…ç½®
public class DatabaseOptions
{
    public string Server { get; set; } = "localhost";
    public int MaxConnections { get; set; } = 100;
}

public class LoggingOptions
{
    public string LogLevel { get; set; } = "Debug";
}
```

#### âœ… å¯è§æ€§æ£€æŸ¥
å¸¸é‡çš„è®¿é—®ä¿®é¥°ç¬¦åº”è¯¥åˆé€‚ï¼š

```csharp
// âœ… æ­£ç¡®ï¼šæ ¹æ®ä½¿ç”¨èŒƒå›´é€‰æ‹©å¯è§æ€§
public class MyService
{
    // ä»…å†…éƒ¨ä½¿ç”¨
    private const int InternalBufferSize = 1024;
    
    // åŒç¨‹åºé›†å†…å…±äº«
    internal const int SharedBufferSize = 8192;
    
    // å…¬å…± API
    public const int PublicMaxSize = 65536;
}

// âš ï¸ è€ƒè™‘ä½¿ç”¨ readonly static ä»£æ›¿ const
public class Settings
{
    // constï¼šç¼–è¯‘æ—¶å¸¸é‡ï¼Œå€¼ä¼šåµŒå…¥åˆ°è°ƒç”¨ä»£ç ä¸­
    public const string Version = "1.0.0";
    
    // readonly staticï¼šè¿è¡Œæ—¶å¸¸é‡ï¼Œæ›´çµæ´»
    public static readonly string Version = "1.0.0";
}
```

**const vs readonly static**ï¼š
- `const`ï¼šç¼–è¯‘æ—¶å¸¸é‡ï¼Œå€¼åµŒå…¥è°ƒç”¨ä»£ç ï¼Œä¿®æ”¹åéœ€è¦é‡æ–°ç¼–è¯‘æ‰€æœ‰å¼•ç”¨
- `readonly static`ï¼šè¿è¡Œæ—¶å¸¸é‡ï¼Œæ›´çµæ´»ï¼Œä¿®æ”¹ååªéœ€é‡æ–°ç¼–è¯‘å®šä¹‰ç±»

#### âœ… åˆå¹¶ç­–ç•¥
ç›¸åŒç”¨é€”çš„å¸¸é‡åº”è¯¥åˆå¹¶ï¼š

**åˆå¹¶æ­¥éª¤**ï¼š
1. è¯†åˆ«é‡å¤çš„å¸¸é‡å€¼å’Œç”¨é€”
2. åˆ›å»ºæˆ–é€‰æ‹©åˆé€‚çš„ Constants ç±»
3. å°†å¸¸é‡å®šä¹‰ç§»åˆ° Constants ç±»
4. æ›´æ–°æ‰€æœ‰å¼•ç”¨
5. éªŒè¯æµ‹è¯•é€šè¿‡

**å¸¸é‡ç»„ç»‡å»ºè®®**ï¼š
```csharp
// âœ… æ¨èï¼šæŒ‰ä¸»é¢˜ç»„ç»‡
public static class SystemConstants
{
    public static class Retry
    {
        public const int MaxAttempts = 3;
        public const int DelayMs = 1000;
    }
    
    public static class Timeout
    {
        public const int DefaultSeconds = 30;
        public const int ConnectionSeconds = 10;
    }
    
    public static class Buffer
    {
        public const int DefaultSize = 8192;
        public const int MaxSize = 65536;
    }
}

// ä½¿ç”¨ï¼šSystemConstants.Retry.MaxAttempts
```

**æŠ€æœ¯å€ºåŠ¡è®°å½•**ï¼š
- é‡å¤å¸¸é‡è®°å½•ä¸º `TD-CLONE-CONST-NNN`
- åº”è¯¥æ”¹ä¸ºé…ç½®è®°å½•ä¸º `TD-CONFIG-CONST-NNN`

---

## PR å®¡æŸ¥æœ€ç»ˆæ£€æŸ¥

åœ¨æ‰¹å‡† PR å‰ï¼Œç¡®è®¤ä»¥ä¸‹æ‰€æœ‰æ£€æŸ¥é¡¹ï¼š

### å½±åˆ†èº«æ£€æµ‹
- [ ] âœ… è¿è¡Œè‡ªåŠ¨åŒ–æ£€æµ‹è„šæœ¬é€šè¿‡
- [ ] âœ… æšä¸¾è¯­ä¹‰æ— é‡å¤æˆ–å·²è®°å½•æŠ€æœ¯å€ºåŠ¡
- [ ] âœ… æ¥å£æ–¹æ³•ç­¾åæ— é‡å æˆ–å·²è¯´æ˜
- [ ] âœ… DTO å­—æ®µç»“æ„æ— é«˜åº¦ç›¸ä¼¼æˆ–å·²åˆå¹¶
- [ ] âœ… Options ç±»æ— è·¨å‘½åç©ºé—´é‡å¤
- [ ] âœ… æ‰©å±•æ–¹æ³•ç­¾åæ— é‡å¤
- [ ] âœ… é™æ€ç±»åŠŸèƒ½æ— é‡å¤
- [ ] âœ… å¸¸é‡é‡å¤åœ¨åˆç†èŒƒå›´å†…

### æŠ€æœ¯å€ºåŠ¡ç®¡ç†
- [ ] âœ… æ–°å¢æŠ€æœ¯å€ºåŠ¡å·²è®°å½•åˆ°æ–‡æ¡£
- [ ] âœ… é«˜ä¼˜å…ˆçº§æŠ€æœ¯å€ºåŠ¡å·²è§£å†³æˆ–æœ‰æ˜ç¡®è¯´æ˜
- [ ] âœ… æŠ€æœ¯å€ºåŠ¡ç¼–å·æ ¼å¼æ­£ç¡®
- [ ] âœ… PR æè¿°åŒ…å«æŠ€æœ¯å€ºåŠ¡å˜æ›´è¯´æ˜

### ä»£ç è´¨é‡
- [ ] âœ… ä»£ç ç¬¦åˆé¡¹ç›®è§„èŒƒ
- [ ] âœ… æ¶æ„åˆ†å±‚æ­£ç¡®
- [ ] âœ… å‘½åè§„èŒƒä¸€è‡´
- [ ] âœ… æ–‡æ¡£å·²åŒæ­¥æ›´æ–°

---

## ç›¸å…³æ–‡æ¡£

- [æŠ€æœ¯å€ºåŠ¡æ–‡æ¡£](./æŠ€æœ¯å€ºåŠ¡.md) - **å¿…è¯»**
- [ä»£ç å®¡æŸ¥æ£€æŸ¥æ¸…å•ï¼ˆåŸæœ‰ï¼‰](./ä»£ç å®¡æŸ¥æ£€æŸ¥æ¸…å•.md.backup)
- [é¡¹ç›®è§„åˆ™é›†](./é¡¹ç›®è§„åˆ™é›†.md)
- [æ¶æ„ç¡¬æ€§è§„åˆ™](./æ¶æ„ç¡¬æ€§è§„åˆ™.md)
- [CONTRIBUTING.md](../../CONTRIBUTING.md)

---

**ç‰ˆæœ¬**: v2.0  
**æœ€åæ›´æ–°**: 2025-12-11  
**ç»´æŠ¤è€…**: ZakYip Team

**æœ¬æ£€æŸ¥æ¸…å•åº”ä¸è‡ªåŠ¨åŒ–æ£€æµ‹è„šæœ¬é…åˆä½¿ç”¨ï¼Œç¡®ä¿å…¨é¢çš„ä»£ç è´¨é‡æ£€æŸ¥ã€‚**
